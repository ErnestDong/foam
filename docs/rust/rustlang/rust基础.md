---
tags: rust
---
# rust基础

## 变量绑定与解构

绑定不是赋值，见[[ownership]]

绝大多数情况下类型标注可以省略由编译器推断，但是函数参数必须标注类型。

```rust
let x = 5; // 默认不可变
let mut y = 5; // mut 可变
let (a, mut b) = (1, 2); // 解构
const MAX_POINTS: u32 = 100_000; // 常量
```

- rust也会存在整数溢出，但只在`debug`模式下检查。
- rust提供了序列，`1..5`为左闭右开区间，`1..=5`为左闭右闭区间。序列只允许用于数字或字符类型

## 函数

函数默认返回`()`，即空元组，可以使用`return`关键字返回值，不写`return`返回值为最后一行表达式的值(如果有`;`则最后一行表达式为空)。

```rust
fn function_name(x:type, y:type)->type{
    // function body
}
```

当用 `!` 作函数返回类型的时候，表示该函数永不返回(diverge function)，这种语法往往用做会导致程序崩溃的函数，比如 `panic!` 宏。

## 复合类型

### 字符串

切片就是对 String 等集合类型中某一部分的引用，它的类型是 `&str`，方法是`&s[0..5]`，左闭右开。注意这里的开闭区间是针对字节的，而不是针对字符的，汉字一个字符占三个字节。

### 元组

可以模式匹配解构，`let (x, y, z) = tup;`，也可以用`let x = tup.0;`访问。

### 结构体

结构体更新可以类似[[javascript]]，`user2=User{email:String::from(""),..user1}`

## 流程控制

### `if`

`if` 语句的返回值可以赋值给变量(为了规避[[lifetime]])，返回值必须相同，比如：

```rust
let number = if condition {
    5
} else {
    6 // 不能是 "six"
};
```

### `for`

通常采用引用的方式避免[[ownership]]转移，比如：

```rust
for item in &container {
  // ...
}
```

循环也可以采用`while`或`loop`

## [[模式匹配]]

## 方法

rust 使用 `impl` 来定义方法

```rust
struct Circle {
    x: f64,
    y: f64,
    radius: f64,
}

impl Circle {
    // Circle的方法，&self表示借用当前的Circle结构体
    fn area(&self) -> f64 {
        std::f64::consts::PI * (self.radius * self.radius)
    }
    // new是Circle的关联函数，因为它的第一个参数不是self，且new并不是关键字
    fn new(x: f64, y: f64, radius: f64) -> Circle {
        Circle {
            x: x,
            y: y,
            radius: radius,
        }
    }
}
```

- `self` 表示 `Circle` 的所有权转移到该方法中，这种形式用的较少
- `&self` 表示该方法对 `Circle` 的不可变借用
- `&mut self` 表示可变借用

当使用 `object.something()` 调用方法时，Rust 会自动为 `object` 添加 `&`、`&mut` 或 `*` 以便使 object 与方法签名匹配，因而不存在[[cpp]]的`->`

## 泛型 Generics

类似[[cpp]]里面的模版，只不过不想要预先定义`template`。但由于 `T` 可以是任何类型，但不是所有的类型都能加，需要用 `std::ops::Add<Output = T>` 这个[[trait]]对 `T` 进行限制：

```rust
fn add<T: std::ops::Add<Output = T>>(a:T, b:T) -> T {
    a + b
}
```

[//begin]: # "Autogenerated link references for markdown compatibility"
[ownership]: ownership.md "ownership"
[javascript]: ../../javascript/javascript.md "javascript"
[模式匹配]: 模式匹配.md "模式匹配"
[cpp]: ../../cpp/cpp.md "Cpp"
[trait]: trait.md "trait"
[//end]: # "Autogenerated link references"
