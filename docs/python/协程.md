---
tags: python
---
# 协程

调用任务就像调用函数一样，是消耗资源最小的多任务。[[协程]] 适合于需要等待的任务## async IO

in jupyter-python we use `await main()`, but in python file we use `asyncio.run(main())`

```python
import asyncio
async def fetch_data():
    print("start fetching")
    await asyncio.sleep(2)
    return {"data":1}
async def print_num():
    for i in range(10):
        print(i)
        await asyncio.sleep(0.5)
async def main():
    task1 = asyncio.create_task(fetch_data())
    task2 = asyncio.create_task(print_num())
    value = await task1
    print(value)
    await task2
await main()
```

    start fetching
    0
    1
    2
    3
    {'data': 1}
    4
    5
    6
    7
    8
    9

## event loop

我们可以让一个耗时的任务在后台运行。当这个任务完成的时候，event loop 可以 'pick it up';

```python
import asyncio
import aiohttp
result = []
def get_tasks(session):
    tasks = []
    for symbol in ["AAPL", "MSFT", "TSLA", "GOOG"]:
        tasks.append(session.get(url.format(symbol)))
async def get_symbols():
    async with aiohttp.ClientSession() as session:
        tasks = get_tasks(session)
        responses = asyncio.gather(*tasks)
        for response in responses:
            result.append(await response.json())
loop = asyncio.get_event_loop()
loop.run_until_complete(get_symbols())
loop.close()
# or
asyncio.run(get_symbols())
```
