---
tags: algorithm, devops
---

# Paxos 算法

前提条件是通信是可靠的不会被篡改的，但是可能会出现丢失延迟。[[blockchain]]使用的 PBFT 是基于 Paxos 的变种。

## 三个角色

- **Proposer**: 提出提案 (Proposal)。Proposal 信息包括提案编号 (Proposal ID) 和提议的值 (Value)。
- **Acceptor**：参与决策，回应 Proposers 的提案。收到 Proposal 后可以接受提案，若 Proposal 获得多数 Acceptors 的接受，则称该 Proposal 被批准。
- **Learner**：不参与决策，从 Proposers/Acceptors 学习最新达成一致的提案（Value）。

目标是所有节点对编号为`n`值为`value`的`proposal`达成一致。

## 三个阶段

- Prepare 阶段。Proposer 向 Acceptors 发出 Proposal ID `n` 请求，Acceptors 针对收到的 Prepare 请求进行 Promise **承诺**和**应答**。
  - 承诺包括
    - 不再接受 Proposal ID$\le n$的 Prepare 请求。
    - 不再接受 Proposal ID$<n$的 Propose 请求。
  - 应答为不违背以前作出的承诺下，回复已经 Accept 过的提案中 Proposal ID 最大的那个提案的 Value 和 Proposal ID，没有则返回空值。
- Accept 阶段。Proposer 收到多数 Acceptors 承诺的 Promise 后，向 Acceptors 发出 Propose 请求，Acceptors 针对收到的 Propose 请求进行 Accept 处理。
  - Propose:
    - 从应答中选择 Proposal ID 最大的提案的 Value，作为本次要发起的提案。
    - 如果所有应答的提案 Value 均为空值，则可以自己随意决定提案 Value。
    - 然后携带当前 Proposal ID，向所有 Acceptors 发送 Propose 请求。
  - Accept:
    - Acceptor 收到 Propose 请求后，在不违背自己之前作出的承诺下，接受并持久化当前 Proposal ID 和提案 Value
- Learn 阶段。Proposer 在收到多数 Acceptors 的 Accept 之后，标志着本次 Accept 成功，决议形成，将形成的决议发送给所有 Learners。

[//begin]: # "Autogenerated link references for markdown compatibility"
[blockchain]: ../../blockchain/blockchain.md "blockchain"
[//end]: # "Autogenerated link references"
