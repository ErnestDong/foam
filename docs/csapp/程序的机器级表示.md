---
tags: CS, CSAPP
---
# 程序的机器级表示

[[cpp]]代码采用 `gcc -Og` 编译，`-S` 为汇编结果。汇编的 `.` 开头的行是指导链接器和汇编期工作的可以忽略

## 汇编的基本使用

- `pushq`与`popq`：保存寄存器的值与恢复寄存器的值，见 [[计算机组成]]
- `b/w/l/q` 四个后缀分别为操作数长为 1 个 byte/1 个 word/ 2 / 3 个 word
- 指令包括 *操作码* 和 *操作数*
- 操作数可以分为三类
  - 立即数：$ 开头如 `$8` 表示
  - 寄存器：% 开头如 `%rax`
  - 内存引用：()包裹的寄存器，如 `(%rax)` 表示，`Imm(rb,ri,s)`可以是

---

### `mov`

`mov src dest` src 可以是任何操作数，而 dest 为存放 src 数据的寄存器，因而不能是一个立即数

> `push` 和 `pop` 相当于 `mov` 和 add/sub 的组合，改变 rax 的位置同时读写数据

### `leaq`

将值写入目标寄存器， $Imm(r_b,r_i,s)=Imm+R[r_b]+R[r_i]\cdot s$

## 控制流

### 条件码寄存器

描述最近 ALU 中执行指令的结果，长度为一个 bit，当最近一条指令产生标志时会置为 1

- CF：进位标志，检查无符号数相加的溢出
- ZF：零标志，检查运算结果为 0
- SF：符号标志，检查最近运算小于 0
- OF：溢出标志，有符号数正/负溢出

不会直接读条件码寄存器的值

### 跳转指令和循环

循环语句采用条件测试和跳转实现

很长的条件判断，由于 `switch` 采用了跳转表的结构，运行时间与 case 无关，因而会比 `if` 叠加要快

## 过程

### 栈帧 frame

当函数运行需要的存储空间超过寄存器大小时，会借助栈上的存储空间，这部分存储空间称为 frame
