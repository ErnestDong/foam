---
tags: DB
---
# MVCC

多版本并发控制 Multi-Version Concurrency Control

## 并发控制协议

- [[transaction#2PL：Two-Phase Locking]]
- [[transaction#事务的进程]]

## 版本存储

DBMS 使用 tuple 的指针为每个逻辑元组创建一个version chain，一个按时间戳排序的版本的 [[链表]]。

- append only：每次更新只是将 tuple 的新版本附加到表中，并更新version chain
- Time-Travel Storage：每次更新时重新创建一个新表，并更新version chain
- Delta Storage：每次更新的是差异，写快但读慢

## 垃圾回收

随着时间的推移，DBMS 需要从数据库中删除可回收的物理版本。如果没有活动的[[transaction]]可以“看到”某个版本，或者如果该版本是由已中止的[[transaction]]创建的，则该版本是可回收的。

## [[index]]管理

DBMS 更新主键索引的频率取决于更新 tuple 时系统是否创建新版本。

[//begin]: # "Autogenerated link references for markdown compatibility"
[transaction#2PL：Two-Phase Locking]: transaction.md "transaction"
[transaction#事务的进程]: transaction.md "transaction"
[链表]: ../../algorithm/data_structure/链表.md "链表"
[transaction]: transaction.md "transaction"
[index]: index.md "索引"
[//end]: # "Autogenerated link references"
