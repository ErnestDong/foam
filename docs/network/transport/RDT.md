---
tags: Network
---
# 可靠数据传输原理

基于下层不可靠的服务，如何为上层应用提供可靠服务的协议称为 RDT，在应用层、传输层和数据链路层都很重要。采用有限状态机来描述发送方和接收方，可靠定义为 不出错、不丢失

先假设下层是可靠的，一步步放宽假设

## 如果下层是具有比特差错的信道：stop-and-wait 协议

发送方 S 把上层内容与校验和打包成 Packet，交由下层传输给接收方 R ，R 收到后检查校验和是否出错，没有出错发送 `ACK` 给 S 同时向上传数据，否则发送 `NAK` 要求重新发送

信道容量很大的情况下，stop&wait 效率比较低

### 如果 `ACK` 和 `NAK` 可能出错

在 Packet 中添加序号(序号0-N循环使用)，如果收到不是 `ACK` 则重发一遍，R 接收到之后再发 `ACK`，如果重复就不要了

如果 `ACK` 也有编号，那么对当前分组的 `NAK` 可以用上一个分组的 `ACK` 来表示，S 收到上一个 `ACK` 自然会再次发送此分组的 Packet，方便流水线式的发送

## 如果下层存在丢包：超时重传

超时重传设定为正常往返稍多一点的时间，超过就重新发送 Packet

## stop-and-wait 效率的改进：pipeline 协议

信道容量比较大时，吞吐的瓶颈是长途时协议每次只发一个 Pocket，如果一次多发一些 Pocket 会增加效率

### 滑动窗口 slide window 协议

发送有缓冲区方便重发，没有发送的数据可以直接发送，发送窗口是发送缓冲区中已发送但未确认的分组，得到新的确认从发送窗口中移除；
接受窗口和接受缓冲区是一样的，收到数据就放进来，给出当前最高分组的序号 `ACK`，传给上层之后如果是窗口头就移除出去，否则不移动窗口只发送 `ACK`
