---
tags: blockchain
---

# solidity

[WTF Solidity](https://github.com/AmazingAng/WTF-Solidity/)

后缀名为 sol，第一行为版本号 `progma solidity >= 0.6.0 < 0.9.0;`。
`msg` 是一个全局变量，包含了给定交易的相关数据，例如发送者的地址和包含在交易中的 ETH 数量。

solidity 数据存储位置有三类：`storage`，`memory`和`calldata`。不同存储位置的`gas`成本不同。`storage`类型的数据存在链上，类似计算机的硬盘，消耗`gas`多；`memory`和`calldata`类型的临时存在内存里，消耗`gas`少。大致用法：

1. `storage`：合约里的状态变量默认都是`storage`，存储在链上。
2. `memory`：函数里的参数和临时变量一般用`memory`，存储在内存中，不上链。
3. `calldata`：和`memory`类似，存储在内存中，不上链。与`memory`的不同点在于`calldata`变量不能修改（`immutable`），一般用于函数的参数。

## `contract`

类似 `class`，定义了一个[[smart contract]]。数据类型除了常见的数据类型 (int(会 overflow) string bool struct)外，还有 `address`，`mapping`(类似 `dict`)

```solidity
progma solidity ^0.6.0;

contract Test{
    uint256 x; // x is 0 now
    address public owner;
    constructor() public{
        owner = msg.sender;
    }
    mapping(address => uint256) maps;

    function makex(uint256 _x) public returns(uint256){
        x = _x;
        return x;
    }
}
```

`function` 修改可以内部的 state(如 `x`。
如果加了关键字 `view`(类似 [[python]] 的 `@property`)或者 `pure` 不修改 state。
而如果加 `payable`，则可以支付 ETH 给某个地址

`interface` 类似 [[typescript]] 里的 `interface`

`require` 类似 `assert`，必须满足后面的 bool 表达式为真

## deploy

solidity 可以将合约部署到 vm 上，如 `new Test()`，返回合约部署的地址

[//begin]: # "Autogenerated link references for markdown compatibility"
[smart contract]: <smart contract.md> "智能合约"
[python]: ../../python/python.md "python"
[typescript]: ../../javascript/typescript.md "typescript"
[//end]: # "Autogenerated link references"
