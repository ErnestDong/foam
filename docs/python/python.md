---
tags: python
---
# python

## features

- 3.3 `yield from xs`, venv
- 3.4 `asyncio`, `enum`, [[#pathlib]]
- 3.5 `async/await`([[协程]]), typing
- 3.6 f-string, `[i async for i in aiter() if i % 2]`
- 3.7 [[#dataclass]]
- 3.8 `(x := read()) + 1`, `f'{x=}'`
- 3.9 `string.removesuffix()`, `val: list[int] = []`, graphlib
- 3.10 `with (A() as a, B() as b)`, [[#match]]

### pathlib

pathlib 重载了 `/` 运算符
![pathlib](../../attachments/pathlib.png)

### dataclass

it will make the class comparable, (imuttable, hashable)

```python
from dataclasses import dataclass, field
@dataclass(frozen=True) # hashable and imuttable
class Comment:
    id: int = field()
    text: str = field(default="")
```

### match

`match` like `switch` but with `break`, using `case`. case `_` matches all cases.

## [[meta programming]]

## GC

python 引用计数为主，分代收集为辅，当引用数为 0 时清除。
函数内循环引用，函数结束后无法释放内存。

- 小整数[-5, 256]对象在解释器初始化时确定，相同的小整数是同一个 id
- 大整数每次都会生成新的 id
- 字符串驻留(intern)，相同的字符串指向相同的位置(字符串中不包含特殊字符)

```python
# 手动清除
import gc
def recur():
    a = [i for i in range(100_0000_0000)]
    b = [i for i in range(100_0000_0000)]
    a.append(b)
    b.append(a)
recur()
gc.collect()
```

## 上下文管理器

避免 IO 过程中出现错误没有释放资源

### 类的方法实现

只要实现了 `__enter__` 和 `__exit__` 方法，就可以用 `with` 来管理

### 方法实现

`@contextmanager` 这个 decorator 接受一个 generator，用 yield 语句把 with &#x2026; as var 把变量输出出去，然后，with 语句就可以正常地工作了：

```python
from contextlib import contextmanager

@contextmanager
def my_open(path, mode):
    f = open(path, mode)
    """__enter__"""
    yield f
    """__exit__"""
    f.close()
with my_open("file","w") as f:
    f.write(123)
```

## poetry

```shell
poetry new project
poetry init
poetry add package
poetry install
poetry build    # 构建可安装的 *.whl 和 tar.gz 文件
poetry shell    # 会根据定义在 pyproject.toml 文件中的依赖创建并使用虚拟环境
poetry run pytest    # 运行使用 pytest 的测试用例，如 tests/test_sample.py
poetry export --without-hashes --output requirements.txt  # 导出 requirements.txt 文件, --dev  导出含 dev 的依赖，或者用 poetry export --without-hashes > requirements.txt
```

[//begin]: # "Autogenerated link references for markdown compatibility"
[#pathlib]: python.md "python"
[协程]: 协程.md "协程"
[#dataclass]: python.md "python"
[#match]: python.md "python"
[meta programming]: <meta programming.md> "元编程"
[//end]: # "Autogenerated link references"
