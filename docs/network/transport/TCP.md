---
tags: Network
---
# TCP

是点对点的、可靠的、按顺序的字节流服务，数据流双向流动，而且是面向连接的。不保证报文的界限，依赖[[RDT]]，缺陷有：

- 升级 TCP 的工作很困难；
- TCP 建立连接的延迟；
- TCP 存在队头阻塞问题；
- 网络迁移需要重新建立 TCP 连接；

## TCP segment

![TCP segment](../../../attachments/tcp%20segment.jpeg)
序列号是首字节所在的字节流的偏移量，确认序号还以为期望从对方收到的下一个字节的序号，防止老的连接干扰

## 流量控制

TCP 提供了流量控制，以防止发送方接受缓冲区溢出，处理方式是发送方维护一个接受窗口的大小

## TCP 连接的建立

### 三次握手

- 客户端 TCP 向接受端 TCP 发送一个只含首部的 segment，SYN 被置为 1，同时把序号设置为随机数(client_isn，为了增强安全性)
- 服务端 TCP 分配 TCP 缓存和变量(易受 SYN洪泛攻击)，并发送 SYNACK 报文段(SYN 为 1，确认序号为 client_isn+1，序号为 server_isn 随机数)
- 客户端为该连接分配缓存和变量用来确认，此时发送的 segment 确认序号 +1，而 SYN 被设为 0，此时可以携带数据了

> 如果使用 TLS 加密，则还需要一次握手确认通信密钥

### 四次挥手

1. 客户端发送一个FIN段表示不再发送数据了(但仍可以接受数据)
2. 服务端将发送 ACK 并对序号加一
3. 服务端发起自己的 FIN
4. 客户端确认发送 ACK

[//begin]: # "Autogenerated link references for markdown compatibility"
[RDT]: RDT.md "可靠数据传输原理"
[//end]: # "Autogenerated link references"
