---
tags: Database
---

# 索引

sql 优化很多是依靠索引。创建索引后，SELECT 、 ORDER BY 等会快很多

## 索引结构

### [[B 树#B+ 树]]

一种特殊的[[B 树]]

区别在

- 所有元素出现在叶子节点上，非叶子节点虽然有值但只是索引的作用，不存储数据
- 所有叶子节点形成了一个单向 [[链表]]

在 [[mysql]] 中优化成双向循环链表，利于数据排序

### [[哈希表]]

性能高，但只能精确匹配，不支持范围匹配， [[mysql]]中只有 memory 引擎支持

### R-tree

空间索引，地理位置适合， [[mysql]]只有 MyISAM 引擎支持

### Full-text

全文索引，类似 elastic search

## 索引分类

### 通常分类

1. 主键索引

   只能有一个 PRIMARY

2. 唯一索引

   可以有多个 UNIQUE

3. 常规索引

4. 全文索引

### [[mysql]] 分类

- cluster index：有且只有一个且必须有，无论如何至少会存在一个隐藏的 row num 索引，下面挂着行数据
- secondary index：下面挂着 cluster 数据

## [[mysql]] 语法

对某列

```sql
CREATE INDEX idx ON backtest(TRADE_DT)
```

但如果用联合索引，最左边的列没有出现，索引不会生效。如果跳过某一列，后面的列失效

## 索引[[并发]]控制

[[Lock]]是保护数据库的内容不受其他事务影响的更高级别的逻辑原语。事务将在其整个持续时间内保持锁定。数据库系统可以向用户展示在运行查询时持有的锁。锁需要能够回滚更改

[[Latch]]闩是用于 DBMS 内部数据结构不被其他线程修改。仅在进行操作期间保持。闩锁不需要能够回滚更改。

## 排序与聚合

### 排序

数据比较少时可能会采取[[快速排序]]，当数据量大时采用[[归并排序]]。当然，如果已经有[[index]]时 DBMS 可以直接利用 [[B 树#B+ 树]] 排序

### 聚合

- by sorting
- by hashing

[//begin]: # "Autogenerated link references for markdown compatibility"
[B 树#B+ 树]: <../../algorithm/data_structure/B 树.md> "B 树"
[B 树]: <../../algorithm/data_structure/B 树.md> "B 树"
[链表]: ../../algorithm/data_structure/链表.md "链表"
[mysql]: ../sql/mysql.md "mysql"
[哈希表]: ../../algorithm/data_structure/哈希表.md "哈希表"
[并发]: ../../csapp/程序的通信/并发.md "并发"
[Lock]: <../../operating system/并发/Lock.md> "Lock"
[Latch]: latch.md "Latch"
[快速排序]: ../../algorithm/sort/快速排序.md "快速排序"
[归并排序]: ../../algorithm/sort/归并排序.md "归并排序"
[index]: index.md "索引"
[//end]: # "Autogenerated link references"
