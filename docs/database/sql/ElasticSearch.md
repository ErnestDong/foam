---
tags: Database
---

# ElasticSearch

## Lucene

ElasticSearch 是一个开源的分布式、RESTful 的搜索引擎 ，可以用来解决使用[[数据库]]进行模糊搜索时存在的性能问题，基于 Lucene。

Lucene 是一个 Java 语言编写的高性能、全功能的文本搜索引擎库，提供强大的索引和搜索功能，以及拼写检查、高亮显示和高级分析功能，但并没有分布式以及高可用的解决方案。

ElasticSearch 封装了许多 Lucene 底层功能，提供了简单易用的 RestFul API 接口和多种语言的客户端，开箱即用，自带分布式以及高可用的解决方案。

## 核心技术

- 倒排索引：建立`{value: [key1, key2]}`的索引，并把[[index]]用有限状态机 FST 压缩索引大小
- 分词技术：搜索`dogs`和`dog`匹配到相同结果
- 压缩：`[key1, key2]`可能会很多，压缩算法 Frame of Reference 节约空间
- 缓存：ES 的 `filter` 语句采用了 Roaring Bitmap 技术来缓存搜索结果，保证高频 `filter` 查询速度的同时降低存储空间消耗。
- 联查：在有 filter cache 的情况下，会直接利用位图的原生特性快速求交并集得到联合查询结果，否则使用[[跳表]]对多个 postings list 求交并集，跳过遍历成本并且节省部分数据的解压缩 cpu 成本。

## 应用场景

- 网站关键词搜索
- ELK 日志采集系统中的日志搜索

## 与 [[SQL]]的对应

|      | SQL                                                          | ElasticSearch                                      |
| ---- | ------------------------------------------------------------ | -------------------------------------------------- |
|      | database                                                     | index                                              |
|      | table                                                        | type                                               |
|      | row                                                          | document                                           |
|      | column                                                       | field                                              |
| 查询 | `SELECT * FROM table WHERE field = value`                    | `GET /index/_search?q=field:value`                 |
| 增加 | `INSERT INTO table VALUES (value1, value2, ...)`              | `POST /index/_doc`                                 |
| 删除 | `DELETE FROM table WHERE field = value`                      | `DELETE /index/_doc`                               |
| 更新 | `UPDATE table SET field = value WHERE field = value`         | `POST /index/_update`                              |

其他

- `mappings`：相当于 SQL 中的 `schema`，定义了字段的类型和属性

[//begin]: # "Autogenerated link references for markdown compatibility"
[数据库]: ../%E6%95%B0%E6%8D%AE%E5%BA%93.md "数据库"
[index]: <../database systems/index.md> "索引"
[跳表]: ../../algorithm/data_structure/%E8%B7%B3%E8%A1%A8.md "跳表"
[SQL]: sql.md "mysql"
[//end]: # "Autogenerated link references"
