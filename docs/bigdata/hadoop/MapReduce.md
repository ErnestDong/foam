---
tags: devops
---

# MapReduce @dean2008mapreduce

[[函数式编程]]中无副作用的`map`和`reduce`用来处理大数据计算。`map`函数从每条输入记录中提取一对键值，按键排序所有的键值对后，`reduce`函数对每个键值对列表中的值进行聚合。

## 理念

MapReduce 把所有的计算都拆分成两个基本的计算操作，即 Map 和 Reduce。其中

- Map 函数以一系列键值对作为输入，然后输出一个中间文件 Intermediate。这个中间态是另一种形式的键值对
- Reduce 函数将这个中间态作为输入，计算得出结果。

Map 函数和 Reduce 函数的逻辑都是由开发人员自行定义的。

## 分布式应用

- 将输入文件分割成 M 个个片段，然后每个 Map Worker 读取对应的片段并执行 Map 函数，将结果存入中间文件。
- Reduce Work 则通过 Master 得知中间文件的位置，然后读取其对应中间文件的内容并运行 Reduce 函数，最后把结果输出到结果文件中。
- Master 节点会定期地将当前运行状态存为快照，当 Master 节点崩溃，就从最近的快照恢复然后重新执行任务。
  - Master 节点会定期地 Ping 每个 Work 节点，一旦发现 Work 节点不可达，针对其当前执行的是 Map 还是 Reduce 任务，会有不同的策略。
    - 如果是 Map 任务，无论任务已完成或是未完成，都会废除当前节点的任务。之后，Master 会将任务重新分配给其他节点，同时由于已经生成的中间文件不可访问，还会通知还未拿到中间文件的 Reduce Worker 去新的节点拿数据。
    - 如果是 Reduce 任务，由于结果文件存在 GFS 中，文件的可用性和一致性由 GFS 保证，所以 Master 仅将未完成的任务重新分配。

[//begin]: # "Autogenerated link references for markdown compatibility"
[函数式编程]: ../../javascript/函数式编程.md "函数式编程"
[//end]: # "Autogenerated link references"
