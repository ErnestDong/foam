---
tags: compilers, python
---
# 正则表达式

由[[有限自动机]]实现

## 正则语言定义

正则语言(语言的定义见[[Lexical Analysis#语言]])是一种基本符号表$\Sigma$上的：
$$
R=\begin{cases}
    \epsilon \\
    `c', c\in\Sigma\\
    R+R & \\
    R^2 \\
    R^*
\end{cases}
$$

### 变体

- 一个或多个实例：`+`
- 零个或一个实例：`?`
- 字符类：取或用$a_1|\dots|a_n$，可以写成$[a_1-a_n]$，取反则用 `[^a-z]`，

## perl风格语法

### 元字符

| 代码/语法 | 说明                         |
| --------- | ---------------------------- |
| .         | 匹配除换行符以外的任意字符   |
| \w        | 匹配字母或数字，\W为反       |
| \s        | 匹配任意的空白符，\S为反     |
| \d        | 匹配数字，\D为反             |
| \b        | 匹配单词的开始或结束，\B为反 |
| ^         | 匹配字符串的开始             |
| $         | 匹配字符串的结束             |

### 限定符

| 代码/语法 | 说明             |
| --------- | ---------------- |
| *         | 重复零次或更多次 |
| +         | 重复一次或更多次 |
| ?         | 重复零次或一次   |
| {n}       | 重复n次          |
| {n,}      | 重复n次或更多次  |
| {n,m}     | 重复n到m次       |

## [[python]]语法

### flags

`re.find_all(pattern,text,flag)`中的 `flag`，常用的有

| enum       | 缩写   | 作用                                         |
| ---------- | ------ | -------------------------------------------- |
| IGNORECASE | `re.I` | 忽略大小写匹配                               |
| ASCII      | `re.A` | 让 `\w`等只匹配ASCII，而不是Unicode。        |
| DOTALL     | `re.S` | `.`匹配所有，包括换行符`\n`                  |
| MULTILINE  | `re.M` | 多行模式下是支持匹配行开头的                 |
| VERBOSE    | `re.X` | 详细模式，可以在正则表达式中加注解(# 为注释) |

### 查找

1. search： 查找任意位置的匹配项
2. match： 必须从字符串开头匹配
3. fullmatch： 整个字符串与正则完全匹配
4. findall： 从字符串任意位置查找，返回一个列表
5. finditer：从字符串任意位置查找，返回一个迭代器

### 字符串操作

- 分割`re.split(pattern, string, maxsplit=0, flags=0)`：用 pattern 分开 string，maxsplit表示最多进行分割次数
- 替换`re.sub(pattern, repl, string, count=0, flags=0)` ：repl替换掉string中被pattern匹配的字符， count表示最大替换次数
  - `re.subn`与`re.sub` 功能一致，只不过返回一个元组 (字符串, 替换次数)。

## 编译

`compile`将正则表达式的样式编译为一个 正则表达式对象 Pattern，与re模块有同样的正则函数。
**在多次使用某个正则表达式时推荐使用正则对象Pattern** 以增加复用性，因为通过`re.compile(pattern)`编译后的模块级函数会被缓存

[//begin]: # "Autogenerated link references for markdown compatibility"
[有限自动机]: ../compilers/model/有限自动机.md "finite automata"
[Lexical Analysis#语言]: <../compilers/procedure/Lexical Analysis.md> "词法分析"
[python]: python.md "python"
[//end]: # "Autogenerated link references"
