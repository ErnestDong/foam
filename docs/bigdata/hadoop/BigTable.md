---
tags: devops
---

# BigTable @chang2008bigtable

基于[[GFS]]的结构化数据的存储系统，实际上是一个 KV 数据库

## 数据结构

- `key`：行关键字+列关键字+时间戳，例如 url+title+2019-01-01
- `value`：未解析的 byte 数组

## [[NoSQL]]

BigTable 提供了

- 建表、删表等 DDL 操作
- 单行数据的增删查，不支持修改，只支持单行的[[transaction]]
- 范围扫描(`where`的弱化版)

## 架构设计

最底层将数据按字典序排序分区后作为一个`tablet`，一个`tablet`对应一个[[GFS]]文件，是一颗 [[LSM树]]；存储`tablet`位置信息的是一颗[[B 树]]，可以缓存到客户端。

每个`tablet`由一个`master`和多个`replica`组成，`master`负责处理读写请求，`replica`负责备份数据，`master`和`replica`之间通过`gossip`协议进行通信。

## Percolator

让 BigTable 支持[[transaction]]的系统，为增量计算提供了支持，在列族中加入了`data`和`lock`。是一个两阶段提交的系统，第一阶段是`prepare`，第二阶段是`commit`。

[//begin]: # "Autogenerated link references for markdown compatibility"
[GFS]: GFS.md "Google File Systems @ghemawat2003google"
[NoSQL]: ../../database/sql/nosql.md "NoSQL"
[transaction]: <../../database/database systems/transaction.md> "transaction"
[LSM树]: ../distributed/LSM树.md "LSM 树"
[B 树]: <../../algorithm/data_structure/B 树.md> "B 树"
[//end]: # "Autogenerated link references"
